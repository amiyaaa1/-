# Chrome 沙箱一次性环境脚本说明

本项目包含批处理脚本 `111.bat`，用于批量创建完全隔离的 Chrome 沙箱环境。脚本会在本次会话内创建独立的用户数据目录，自动记录所有目录路径，并在检测到关联 Chrome 进程全部关闭后执行批量清理（带倒计时确认，可取消）。

## 主要功能

- **会话目录管理**：记录本次会话生成的所有沙箱目录，并在 Chrome 全部关闭后提示统一清理。
- **自动打开预设链接**：支持在每个沙箱窗口启动时打开一个或多个指定链接（可在脚本中配置，或通过独立文本文件维护）。
- **Cookie 导出**：在沙箱运行期间，可按需输入任意网站链接，自动抓取所有沙箱实例中该站点的完整 Cookie，并保存至指定目录，文件名格式为“域名_随机数字.txt”。

## 使用步骤

1. 按需修改脚本顶部的配置项（见下文）。
2. 运行 `111.bat`，输入要启动的沙箱窗口数量。
3. 在沙箱使用过程中：
   - 如需导出 Cookie，按提示输入 `1`，再输入目标网址即可。
   - 直接按回车则持续等待沙箱关闭。
4. 关闭所有沙箱窗口后，脚本会提示是否删除本次会话生成的目录。确认后将自动清理记录中的全部路径。

## 需要手动修改/确认的配置

在 `111.bat` 文件开头可以看到以下变量：

| 变量名 | 作用 | 备注 |
| --- | --- | --- |
| `chrome_path` | Chrome 可执行文件路径 | 必须改成本机实际路径。 |
| `USE_INCOGNITO` | 是否默认使用无痕模式 (`1`=是, `0`=否) | 可按需求调整。 |
| `AUTO_OPEN_URLS` | 以分号分隔的链接列表 | 若链接带有 `&` 等特殊字符，需要使用 `^&` 进行转义。可留空并改用外部文件。 |
| `AUTO_OPEN_URLS_FILE` | 链接列表文本文件路径 | 默认指向脚本目录下的 `auto_urls.txt`。文件不存在则忽略。每行一个链接，可使用 `#` 开头的注释行。 |
| `COOKIE_SAVE_DIR` | Cookie 导出的保存目录 | 请改成实际需要的路径，如 `D:\ai translate\cookie`。脚本会在导出时自动创建目录。 |
| `REMOTE_DEBUG_BASE_PORT` | Chrome 远程调试端口起始值 | 同时开启多个沙箱窗口时会依次 +1。如端口被占用，可改成其他连续端口段。 |

> **提示**：如果链接中包含空格或分号，建议写入 `AUTO_OPEN_URLS_FILE` 所指定的文本文件中，每行一个完整链接，可避免复杂的转义问题。

## Cookie 导出说明

- 在脚本提示界面输入 `1` 后，可输入完整网址（含 `https://`）。
- 脚本会连接到每个沙箱窗口对应的 DevTools 远程调试端口，获取与该网址匹配的全部 Cookie。
- 导出的文件名称形如 `example.com_123456.txt`，保存在 `COOKIE_SAVE_DIR` 指定的目录内，内容为 JSON 格式，方便后续处理。
- 如果未获取到 Cookie，请确认目标站点已在沙箱窗口中访问/登录后再试。

## 目录记录

- 本次会话创建的所有目录会写入 `%TEMP%\ChromeSession_<会话ID>_dirs.log`。
- 清理成功后会自动删除该记录文件；若选择保留目录或清理失败，文件会保留以供手动处理。

## 依赖说明

- 需要 Windows 10 及以上版本，具备 PowerShell 5.1（默认随系统提供）。
- Cookie 导出功能依赖 `cookie_export.ps1`，不要删除或移动该文件；如需自定义位置，请同步修改 `111.bat` 中的 `POWERSHELL_EXPORT_SCRIPT` 变量。

